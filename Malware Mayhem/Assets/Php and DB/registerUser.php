<?php
 include 'connection.php';


$userName= $_POST['username'];
$email = $_POST['email'];
$password = $_POST['password'];

$query1 = "SELECT * FROM user WHERE email = '".$email."'";
$query2 = "SELECT * FROM user WHERE userName = '".$userName."'";
$result = mysqli_query($conn, $query1);
$userNameChecker = mysqli_query($conn, $query2);

// Checks if an account using the email already exists in the database.
if (mysqli_num_rows($result) > 0) {
    echo "E-mail is already taken";
}
else if(mysqli_num_rows($userNameChecker) > 0) {
    echo "Username is already Taken";
}
else {
    $query3 = "INSERT INTO user (userName,email,password) VALUES ('".$userName."','".$email."','".$password."')";
    $accCreateResult = mysqli_query($conn, $query3);
    $query4 = "SELECT userId FROM user WHERE userName = '".$userName."'";
    $fetchID = mysqli_query($conn, $query4);
        while ($row = mysqli_fetch_array($fetchID, MYSQLI_BOTH)){
            $query5 = "INSERT INTO test (userId,preTestResult,postTestResult,preTest,postTest) VALUES ($row[userId],0,0,0,0)"; 
            $accTestTable = mysqli_query($conn, $query5);
        }

    if($accCreateResult === TRUE){
        session_start();
        $_SESSION['userId'] = $row["userId"];
        
        echo "1";
    }
    else{
        echo "Error!";
    }
}
?>